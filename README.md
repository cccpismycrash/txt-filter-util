# Описание проекта txt-filter-util

Версия Java: `25`

Взаимодействие пользователя и утилиты производится через CLI.

Фильтрует входные файлы в зависимости от типа данных на `целочисленные`, `вещественные` и `строковые` типы.
Результаты фильтрации сохраняются в файлы `integers.txt`, `floats.txt` и `strings.txt` соответственно. 

Также имеются опции, позволяющие изменить логику работы команды.

# Формат команды

    app.jar [-o <path>] [-p <prefix>] [-a] [-s | -f] [relative_path]data1.txt [[relative_path]data2.txt ...]

Порядок опций не имеет значения. Путь до входных данных можно передавать через относительный путь.

# Описание опций

| Опция                   | Описание                                                                                                                                                                                                                                               |
|-------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `--help`                | Выводит справку по использованию утилиты.                                                                                                                                                                                                              |
| `-o, --output <path>`   | Указывает путь вывода результата утилиты. Передаваемый путь может быть `абсолютным` или `относительным`. <br/> Примеры аргумента: <br/> 1. `C:/Users/User/some/path/` <br/> 2. `c:\Users\User\some\path` <br/> 3. `./some/path` <br/> 4. `\some\path\` |
| `-p, --prefix <prefix>` | Указывает префикс для имени выходных файлов. <br/> Пример аргумента: `new_` <br/> Результат: `new_integers.txt`, `new_floats.txt`, `new_strings.txt`                                                                                                   |
| `-a, --append`          | Устанавливает режим добавления к существующим файлам. Если режим не указан, существующие файлы будут перезаписаны.                                                                                                                                     |
| `-s`                    | Устанавливает режим вывода краткой статистики в консоль.                                                                                                                                                                                               |
| `-f`                    | Устанавливает режим вывода полной статистики в консоль.                                                                                                                                                                                                |

# Примеры использования

        app.jar -s -a -p sample- in1.txt
        app.jar -o ./some/path -s -a in1.txt in2.txt in3.txt in4.txt
        app.jar -o C:/Users/User/some/path -p new_ -f -a data1.txt data2.txt
        app.jar in1.txt in2.txt in3.txt


# Пример вывода `--help`

    Usage:
        app.jar [-o <path>] [-p <prefix>] [-a] [-s | -f] [relative_path]data1.txt [[relative_path]data2.txt ...]
    
    Description:
        Filters input files based on data type into integer, real, and string types.
        The filtering results are saved as integers.txt, floats.txt, and strings.txt, respectively.
    
    Options:
        --help                         Output help on using the utility.
        -o, --output <path>            Specifies the output path for the utility's result. The passed path can be absolute or relative.
        -p, --prefix <prefix>          Specifies a prefix for the name of the output files.
        -a, --append                   Sets the mode for adding to existing files. If the mode is not specified, existing files will be overwritten.
        -s                             Sets the mode for displaying brief statistics in the console.
        -f                             Sets the mode for displaying complete statistics to the console.
    
    Examples:
        app.jar -s -a -p sample- in1.txt
        app.jar -o ./some/path -s -a in1.txt in2.txt in3.txt in4.txt
        app.jar -o C:/Users/User/some/path -p new_ -f -a data1.txt data2.txt
        app.jar in1.txt in2.txt in3.txt

# Детали реализации

Весь функционал содержится в 6 классах:
1. `Main`
2. `ArgumentsHandler`
3. `FileProcessor`
4. `ViewHandler`
5. `Statistics`
6. `FileSystemManager`

Все методы перечисленных классов были описаны в коде при помощи `Javadoc`.

**Далее производится описание всех перечисленных классов.**

## Класс `Main`

Класс представлен одним методом `main`.

Самый высокий уровень абстракции. Использует методы `ArgumentsHandler`, `FileProcessor`, `ViewHandler`.

Описание работы:
1. Объявление и инициализация результирующих массивов.
2. Объявление флагов, путей и массива с путями к входным данным.
3. Обработка аргументов, переданных на вход утилиты, через `ArgumentsHandler`.
4. Загрузка входных данных и их фильтрация в цикле через `FileProcessor`.
5. Извлечение выходных путей для отфильтрованных данных из полей `ArgumentsHandler` и их запись в файлы через `FileProcessor`.
6. Формирование вывода в консоль через `ViewHandler`.

***Как происходит формирование вывода в консоль на верхнем уровне?***

1. Извлекаются параметры, отвечающие за вывод краткой и полной статистики из полей `ArgumentsHandler`.
2. Если был включен режим краткой статистики:
   - Если были обнаружены и записаны в файл `целочисленные` данные, то в вывод добавляется блок с краткой статистикой по `целочисленным` данным.
   - Если были обнаружены и записаны в файл `вещественные` данные, то в вывод добавляется блок с краткой статистикой по `вещественным` данным.
   - Если были обнаружены и записаны в файл `строковые` данные, то в вывод добавляется блок с краткой статистикой по `строковым` данным.
3. Если был включен режим полной статистики (в дополнение к краткой статистике):
   - Если были обнаружены и записаны в файл `целочисленные` данные, то в вывод добавляется блок с полной статистикой по `целочисленным` данным.
   - Если были обнаружены и записаны в файл `вещественные` данные, то в вывод добавляется блок с полной статистикой по `вещественным` данным.
   - Если были обнаружены и записаны в файл `строковые` данные, то в вывод добавляется блок с полной статистикой по `строковым` данным.

## Класс `ArgumentsHandler`

Класс представлен одним методом `parseArgs`.

Класс предназначен для обработки и контроля правильности передаваемых входных аргументов в CLI.

Обработка аргументов производится при помощи цикла for-each и оператора switch. При помощи switch определяются опции и их обработка.

После обработки аргументов, класс содержит в себе информацию о настроенных режимах работы пользователем. Данная информация содержится в полях класса и доступна через геттеры. 

В статических полях содержатся:
- Массив с путями файлов входных данных.
- Флаги, отображающие режимы работы утилиты.
- Названия выходных файлов.
- Рабочая директория, откуда была запущена утилита.
- Путь для выходных данных.

Обработка правильности входных аргументов опций производится при помощи регулярных выражений.

Регулярные выражения для проверки правильности передаваемых аргументов:
1. Проверка названий входных данных: `.+\\.txt$`.
2. Проверка правильности относительных путей: `^.?(?:[/\\][\da-zA-Z_\-. ]+[/\\]?)+$`.
3. Проверка правильности абсолютных путей: `^[a-zA-Z]:(?:[/\\][\da-zA-Z_\-. ]+[/\\]?)+$`.
4. Проверка префиксов: `^[^\\/:*?"<>|]+$`.

Выходные пути проверяются на возможность создания директорий и файлов в случае их отсутствия. 
Если произошла ошибка при обработке входных параметров, пустые директории и файлы 
не будут созданы. Проверка возможности создания директорий и файлов производится при 
помощи `FileSystemManager`.

Если все параметры были обработаны успешно, то в полях класса сохраняются выходные пути для результатов работы утилиты.

## Класс `FileProcessor`

Класс представлен методами:
1. `loadFile`.
2. `filter`.
3. `writeFile`.

Класс предназначен для обработки файлов с входными данными и сохранения результатов обработки.

Фильтрация данных происходит при помощи регулярных выражений по аналогии с классом `java.util.Scanner`.

Регулярные выражения:
1. Для проверки `целочисленных` типов: `^[-+]?\d+$`.
2. Для проверки `вещественных` типов: `^[-+]?[\d]+[.,][\d]+(?:[eE][+-]?[\d]+)?$`.

Для `целочисленных` типов предполагается, что они могут быть как положительными, так и отрицательными и помещаются в тип `long`.

Для `вещественных` типов предполагается, что они могут быть отрицательными и положительными, разделителем может быть
как точка, так и запятая, могут быть записаны в обычном и экспоненциальном виде и помещаются в тип `double`.

Для `строковых` типов предполагается, что они могут состоять как из букв, так из знаков препинания и
прочих символов. То есть, если строка не попадает под `целочисленный` или `вещественный` тип, то она будет определена как `строковый` тип.

***Как происходит запись данных в файл***

1. Проверяется, существует ли файл по сформированному выходному пути во время обработки аргументов в CLI. Если файла по выходному пути не существует, то создаются пустой файл и промежуточные директории.
2. В файле по выходному пути происходит запись данных через `BufferedWriter` и `FileWriter`. 
3. Если не возникло ошибок во время записи, то возвращается `true`, если файл не был записан или же записывать нечего (был передан пустой массив), то возвращаетися `false`.

На основе того, были ли записаны данные в файл или нет, зависит вывод утилиты. Если данные по определённому типу не 
были записаны, то по этому типу не будет выводиться статистика. 

## Класс `ViewHandler`

Класс представлен методами:
1. `addSimpleStatsIntegers`.
2. `addSimpleStatsFloats`.
3. `addSimpleStatsStrings`.
4. `addFullStatsIntegers`.
5. `addFullStatsFloats`.
6. `addFullStatsStrings`.
7. `createFinalView`.
8. `showFinalView`.

Класс предназначен для формирования ответа и вывода в консоль результата работы утилиты.

Класс основан на формировании отдельных кусков вывода и работе с ними, из которых строится финальный ответ.

Любое успешное завершение программы сопровождается уведомлением `The program was successfully executed.`

Класс содержит следующие строковые поля:
- Финальный вывод. Содержит уведомление об успешном выполнении программы.
- Вывод по целым типам. Изначально пустое.
- Вывод по вещественным типам. Изначально пустое.
- Вывод по строковым типам. Изначально пустое.

При включении режима краткой или полной статистики, к строковым выводам по соответствующим типам сопровождается
применением соответствующих методов и добавлением к полям соответствующих частей вывода.

В ситуации, когда не нужно выводить статистику, в консоль будет выведено
только уведомление об успешном выполнении программы.

Расчёт статистики производится при помощи класса `Statistics`.

После добавления полям шаблонов вывода по соответствующим типам вызываются методы `createFinalView` и `showFinalView`, 
которые отвечают за формирование финального вывода и отображения его в консоли.

Пример вывода для режима краткой статистики при условии обнаружения `целочисленных`, `вещественных` и `строковых` данных:

      The program was successfully executed.
      
      Integers:
         - Number of elements:     2
      
      Floats:
         - Number of elements:     5

      Strings:
         - Number of elements:     11

Пример вывода для режима полной статистики при условии обнаружения `целочисленных`, `вещественных` и `строковых` данных:

      The program was successfully executed.
      
      Integers:
         - Number of elements:     2
         Extended statistics:
              - Min:               481
              - Max:               1234
              - Sum:               1715
              - Mean:              857,5000
      
      Floats:
         - Number of elements:     5
         Extended statistics:
              - Min:               -0,0010
              - Max:               15285,3505
              - Sum:               15304,0771
              - Mean:              3060,8154
      
      Strings:
         - Number of elements:     11
         Extended statistics:
              - Shortest length:   4
              - Longest length:    42

## Класс `Statistics`

Класс представлен методами:
1. `getSizeArray`.
2. `getSum`.
3. `getMean`.
4. `getMinValue`.
5. `getMaxValue`.
6. `getMinSizeString`.
7. `getMaxSizeString`.

Класс предназначен для расчёта статистики по отфильтрованным данным для класса `ViewHandler`.

При расчёте среднего значения элементов массива ответственность за корректность передаваемого массива 
(чтобы он не был пустым) передается в класс `FileProcessor`, там идет проверка на наличие хотя бы одного элемента в массиве.
Если бы для расчёта среднего передавался пустой массив, то был выброс ошибки `java.lang.ArithmeticException`, связанная 
с делением на ноль.

## Класс `FileSystemManager`

Класс представлен методами:
1. `findExistingAncestor`.
2. `deleteDirectoryChain`.
3. `checkDirsCreatable`.
4. `checkFileCreatable`.
5. `createFileAndDirs`.

Класс предназначен для проведения операций в файловой системе по созданию файлов и директорий и проверки возможности их создания.

Класс был создан для обособления логики по проверке возможностей создания файлов и директорий
для `ArgumentsHandler` и для создания выходных файлов и промежуточных директорий вне зависимости от их
наличия для `FileProcessor`.

***Как производится поиск ближайшего существующего родительского каталога для заданного пути?***

Поиск ближайшего существующего родительского каталога для заданного пути выполняется путём последовательного обхода 
дерева каталогов вверх.

***Как производится удаление ветки каталогов?***

Удаление выполняется путём последовательного обхода дерева каталогов вверх вплоть до ближайшего существующего
родительского каталога.

***Как производится проверка возможности создания каталогов по заданному пути?***

1. Производится поиск ближайшего существующего родительского каталога.
2. Создаются каталоги по заданному пути.
3. Если не выбрасывается `IOException`, то проверка пройдена. 
4. Созданные каталоги удаляются при помощи `deleteDirectoryChain`.
После проверки в файловой системе не остаётся пустых каталогов в случае возникновения ошибок после 
обработки входных параметров в `ArgumentsHandler`.

***Как производится проверка возможности создания каталогов по заданному пути?***

Процесс похож на проверку возможности создания каталогов, только после создания каталогов, в них создается файл. Потом 
производятся обратные операции по удалению файла и каталогов.

1. Производится поиск ближайшего существующего родительского каталога.
2. Создаются каталоги по заданному пути.
3. В конечном каталоге создается файл.
4. Если не выбрасывается `IOException`, то проверка пройдена.
5. Удаляется созданный файл. 
6. Созданные каталоги удаляются при помощи `deleteDirectoryChain`.

После проверки в файловой системе не остаётся пустых файлов и каталогов в случае возникновения ошибок после
обработки входных параметров в `ArgumentsHandler`.

***Как производится создание файлов и промежуточных каталогов по заданному пути?***

1. Создаются каталоги по заданному пути.
2. В конечном каталоге создается файл.

Данная процедура используется в `FileProcessor` для создания выходных файлов, куда будут записываться 
результаты фильтрации.